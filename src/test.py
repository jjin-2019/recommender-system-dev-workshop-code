import json
import os
import pickle
import boto3

testVar = "this is empty str"
testMap = {}


def testFunc():
    global testVar
    testVar = "test func"
    global testMap
    testMap['testKey'] = "testValuefunc"


def testMapFunc():
    print(testMap['testKey'])


def init():
    global testVar

    global testMap
    testMap['testKey'] = "testValueinit"


def load_config(file_path):
    s3_bucket = 'aws-gcr-rs-sol-dev-workshop-ap-northeast-1-466154167985'
    s3_prefix = 'sample-data-news'
    file_key = '{}/{}'.format(s3_prefix, file_path)
    s3 = boto3.resource('s3')
    # try:
    #     object_str = s3.Object(s3_bucket, file_key).get()[
    #         'Body'].read().decode('utf-8')
    # except Exception as ex:
    #     print("get {} failed, error:{}".format(file_key, ex))
    #     object_str = ""
    # print(object_str)
    object_str = "{}"
    config_json = json.loads(object_str)
    return config_json


def generate_rank_result_from_personalize():
    recall_result = {'6533143503382249998': ['6533143503382249998', 'entities', 11, 11.7], '6553078435520971272': ['6553078435520971272', 'entities', 10, 10.7], '6552330268248637955': ['6552330268248637955', 'entities', 22, 10.7], '6522434181887164942': ['6522434181887164942', 'entities', 1, 10.2], '6430731781586026753': ['6430731781586026753', 'entities', 3, 9.2], '6552272337717166596': ['6552272337717166596', 'entities', 0, 8.7], '6553102743647552007': ['6553102743647552007', 'entities', 9, 8.7], '6511495979802296580': ['6511495979802296580', 'entities', 1, 8.2], '6552486360161190403': ['6552486360161190403', 'entities', 10, 8.2], '6552299939366437379': ['6552299939366437379', 'entities', 2, 7.7], '6503690797857112334': ['6503690797857112334', 'entities', 14, 7.7], '6552374526905156099': ['6552374526905156099', 'entities', 0, 7.7], '6552847918951301645': ['6552847918951301645', 'entities', 2, 7.7], '6553027277771244039': ['6553027277771244039', 'entities', 3, 7.2], '6552294241907769863': ['6552294241907769863', 'entities', 13, 7.2], '6552418370602402307': ['6552418370602402307', 'entities', 4, 6.7], '6552495464749466120': ['6552495464749466120', 'entities', 13, 6.7], '6550502136969429507': ['6550502136969429507', 'entities', 4, 6.7], '6552227304062321156': ['6552227304062321156', 'entities', 19, 6.7], '6552275925357036035': ['6552275925357036035', 'entities', 5, 6.2], '6549865427416121869': ['6549865427416121869', 'entities', 20, 6.2], '6552283003073069571': ['6552283003073069571', 'entities', 11, 6.2], '6552245610378953220': ['6552245610378953220', 'entities', 20, 6.2], '6552256424280326664': ['6552256424280326664', 'type', 0, 5.760000000000001], '6552478601705423374': ['6552478601705423374', 'entities', 6, 5.7], '6552464526082572808': ['6552464526082572808', 'entities', 21, 5.7], '6551146303395463684': ['6551146303395463684', 'entities', 6, 5.7], '6552287915995562499': ['6552287915995562499', 'entities', 12, 5.7], '6552270710901834253': ['6552270710901834253', 'entities', 21, 5.7], '6552367046460441095': ['6552367046460441095', 'entities', 7, 5.2], '6552382613963670019': ['6552382613963670019', 'entities', 5, 5.2], '6552351867639169543': ['6552351867639169543', 'entities', 22, 5.2], '6552478442405757454': ['6552478442405757454', 'entities', 18, 4.7], '6551143270947226126': ['6551143270947226126', 'entities', 14, 4.7], '6462974325749186829': ['6462974325749186829', 'entities', 23, 4.7], '6514096967126089992': ['6514096967126089992', 'entities', 19, 4.2], '6492740382785274125': ['6492740382785274125', 'entities', 23, 4.2], '6553093474382512648': ['6553093474382512648', 'entities', 15, 4.2], '6552280235373494797': ['6552280235373494797', 'entities', 24, 4.2], '6552292881254580749': ['6552292881254580749', 'entities', 16, 3.7], '6552309189182489091': ['6552309189182489091', 'entities', 25, 3.7], '6552434320970088974': ['6552434320970088974', 'type', 0, 3.3600000000000003], '6552313861322572296': ['6552313861322572296', 'type', 2, 3.3600000000000003], '6553012205074252292': ['6553012205074252292', 'type', 4, 3.3600000000000003], '6425119304542322946': ['6425119304542322946', 'entities', 15, 3.2], '6552300408486756877': ['6552300408486756877', 'entities', 26, 3.2], '6552283707258962439': ['6552283707258962439', 'entities', 16, 2.7], '6487184017585078541': ['6487184017585078541', 'entities', 8, 2.7], '6553043992827658755': ['6553043992827658755', 'entities', 17, 2.7], '6552293548434129412': ['6552293548434129412', 'type', 2, 2.5600000000000005], '6552463126468493838': ['6552463126468493838', 'entities', 9, 2.2], '6552353543355892238': ['6552353543355892238', 'entities', 18, 2.2], '6552465169870488068': ['6552465169870488068', 'entities', 27, 2.2], '6552347162926121486': ['6552347162926121486', 'type', 3, 2.16], '6552438173861937677': ['6552438173861937677', 'type', 1, 2.16], '6553358810382074376': ['6553358810382074376', 'type', 3, 1.36], '6546844349055894023': ['6546844349055894023', 'words', 51, 1.22], '6552466742008873486': ['6552466742008873486', 'words', 38, 1.17], '6552236298344595982': ['6552236298344595982', 'words', 104, 1.17], '6533008673860485639': ['6533008673860485639', 'words', 30, 0.97], '6552495505698456072': ['6552495505698456072', 'words', 50, 0.97], '6552381665753170439': ['6552381665753170439', 'type', 4, 0.96], '6552376917822013966': ['6552376917822013966', 'words', 75, 0.9199999999999999], '6538669272304976387': ['6538669272304976387', 'words', 107, 0.9199999999999999], '6552308451060482573': ['6552308451060482573', 'words', 77, 0.87], '6552460748696584717': ['6552460748696584717', 'words', 19, 0.82], '6552350930375803399': ['6552350930375803399', 'words', 39, 0.82], '6552468063009112583': ['6552468063009112583', 'words', 49, 0.82], '6552121360049504776': ['6552121360049504776', 'words', 0, 0.77], '6552105445157241357': ['6552105445157241357', 'words', 40, 0.77], '6553040121124356622': ['6553040121124356622', 'words', 69, 0.77], '6525307899600699918': ['6525307899600699918', 'words', 18, 0.67], '6552342023502823950': ['6552342023502823950', 'words', 28, 0.67], '6552410404251763203': ['6552410404251763203', 'words', 71, 0.67], '6552355102684873230': ['6552355102684873230', 'words', 64, 0.67], '6552348331064951309': ['6552348331064951309', 'words', 6, 0.67], '6467829808729424142': ['6467829808729424142', 'words', 31, 0.6200000000000001], '6501159149416481037': ['6501159149416481037', 'words', 53, 0.6200000000000001], '6552414947869983235': ['6552414947869983235', 'words', 68, 0.6200000000000001], '6552416603969946120': ['6552416603969946120', 'words', 78, 0.6200000000000001], '6552492365280444942': ['6552492365280444942', 'words', 105, 0.6200000000000001], '6551675115115905544': ['6551675115115905544', 'words', 5, 0.6200000000000001], '6525538741556085252': ['6525538741556085252', 'words', 2, 0.5700000000000001], '6497734489664389390': ['6497734489664389390', 'words', 20, 0.5700000000000001], '6458800055699636494': ['6458800055699636494', 'words', 60, 0.5700000000000001], '6537451193822609923': ['6537451193822609923', 'words', 79, 0.5700000000000001], '6552286271123751428': ['6552286271123751428', 'words', 89, 0.5700000000000001], '6552129087962350093': ['6552129087962350093', 'words', 8, 0.5700000000000001], '6552434930909970958': ['6552434930909970958', 'words', 24, 0.5700000000000001], '6553043320002576899': ['6553043320002576899', 'words', 34, 0.5700000000000001], '6552313667285680653': ['6552313667285680653', 'words', 72, 0.5700000000000001], '6552475238863471117': ['6552475238863471117', 'words', 92, 0.5700000000000001], '6477045046196568334': ['6477045046196568334', 'words', 3, 0.52], '6552177362430067213': ['6552177362430067213', 'words', 41, 0.52], '6553172473217548803': ['6553172473217548803', 'words', 70, 0.52], '6454369793683226893': ['6454369793683226893', 'words', 90, 0.52], '6521968288589677060': ['6521968288589677060', 'words', 7, 0.52], '6552498111938298376': ['6552498111938298376', 'words', 27, 0.52], '6552408328486519309': ['6552408328486519309', 'words', 93, 0.52], '6500862040322605325': ['6500862040322605325', 'words', 4, 0.47000000000000003]}

    item_list = [str(int(recall_item)) for recall_item in recall_result]

    print(item_list)


if __name__ == "__main__":
    MANDATORY_ENV_VARS = {
        'RECALL_CONFIG': 'recall_config.pickle',

        'NEWS_ID_PROPERTY': 'news_id_news_property_dict.pickle',
        'ENTITY_ID_NEWS_IDS': 'news_entities_news_ids_dict.pickle',
        'KEYWORD_NEWS_IDS': 'news_keywords_news_ids_dict.pickle',
        'NEWS_TYPE_NEWS_IDS': 'news_type_news_ids_dict.pickle',
        'WORD_ID_NEWS_IDS': 'news_words_news_ids_dict.pickle',

        'LOCAL_DATA_FOLDER': '/tmp/rs-data/',

        'RECALL_PER_NEWS_ID': 10,
        'SIMILAR_ENTITY_THRESHOLD': 20,
        'RECALL_THRESHOLD': 2.0,
        'RECALL_MERGE_NUMBER': 20,

        'REDIS_HOST': 'localhost',
        'REDIS_PORT': 6379,

        'PORTRAIT_SERVICE_ENDPOINT': 'http://portrait:5300'
    }


    generate_rank_result_from_personalize()